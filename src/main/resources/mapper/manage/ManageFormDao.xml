<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.manage.dao.ManageFormDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="io.renren.modules.manage.entity.ManageFormEntity" id="manageFormMap">
        <result property="formId" column="form_id"/>
        <result property="provId" column="prov_id"/>
        <result property="isVisit" column="is_visit"/>
        <result property="visitProv" column="visit_prov"/>
        <result property="healthStatus" column="health_status"/>
        <result property="workStatus" column="work_status"/>
        <result property="workPlace" column="work_place"/>
        <result property="workmateRange" column="workmate_range"/>
        <result property="arrangement" column="arrangement"/>
        <result property="etlTime" column="etl_time"/>
        <result property="userId" column="user_id"/>
        <result property="userName" column="userName"/>
        <result property="provName" column="provName"/>
        <collection property="visitProvNames" select="getVisitProvNames" column="{visitProv=visit_prov}"/>
    </resultMap>
    <select id="selectUserPage" resultMap="manageFormMap">
        select su.chinese_name as userName, mf.*, p.remark as provName from sys_user su left join manage_form mf
        on su.user_id = mf.user_id and date_format(mf.etl_time,'%Y-%m-%d')=date_format(#{params.date},'%Y-%m-%d')
        left join manage_param p on mf.prov_id = p.param_id
        <where>
            and (su.super_id = #{params.userId} or su.user_id=#{params.userId})
            <if test="params.isVisit != null and params.isVisit != ''">
                and mf.is_visit = #{params.isVisit}
            </if>
        </where>
    </select>
    <select id="getVisitProvNames" resultType="string">
        select remark from manage_param
        <where>
            param_id in
            <foreach collection="visitProv.split(',')" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </where>
    </select>
</mapper>
